import socket
import sys

domain_map = {}

def main():
    global domain_app
    args = sys.argv
    print(len(args))
    if len(args) < 2:
        print("python3 ts1.py <port_num>")
        exit(1)


    # initialize the data structure to search for goods!
    with open('ts1database.txt', 'r') as file:
        # Now iterate through the rest of the lines
        for line in file:
            line = line.strip().split()
            if len(line) < 2:
                print("Failed to read line properly")
                continue
            domain_map[line[0]] = line[1]
    # initialize socket
    host_name = socket.gethostname() # get's the current host computer!
    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # create the TCP/IP Socket
    server_socket.bind((host_name,int(args[1]))) # Bind the host_name and port number
    server_socket.listen(1) # we want to wait for one connection
    connection, client_address = server_socket.accept() # Wait for the connection

    try:
        while True:
            data = connection.recv(1024)
            if not data:
                break
            str = data.decode()
            str = str.strip().split()
            print(str)
            if str[1] in domain_map:
                response = f"1 {str[1]} {domain_map[str[1]]} {str[2]} ra"
                connection.sendall(response.encode())
            else:
                response = f"1 {str[1]} 0.0.0.0 {str[3]} nx"
                connection.sendall(response.encode())
            
    finally:
        connection.close()

if __name__ == "__main__":
    main()

# ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢟⣩⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⢩⣿⢫⣿⣿⣿⣿⣿⣏⢏⢿⣿⣿⡌⠻⣿⣿⣯⣹⣿⣿⣿⣿⣿⣯⡹⣿⣿⣿⣿⣿
# ⣿⣿⣿⣿⣿⡿⢫⣤⣤⡐⢶⣮⣭⢛⣵⣿⣿⣿⣿⣿⣿⢹⣿⣿⣿⠿⠿⢿⣛⣛⣛⣛⣛⣃⣛⡋⠼⢿⣿⣿⣿⣿⣿⡌⡎⢿⣿⣿⡌⢎⠻⣿⣿⣯⡻⣿⣿⣿⣿⣷⡜⣿⣿⣿⣿
# ⣿⣿⣿⣿⡟⣴⣿⣿⠿⠿⡌⠟⣱⣿⣿⣿⣿⣿⣿⣿⣿⣼⣿⣷⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣶⣭⣙⠻⣿⣷⢸⡜⣿⣿⣿⡜⣷⡙⣿⣿⣿⣮⡻⣿⣿⣿⣿⡜⢿⣿⣿
# ⣿⣿⣿⡟⠼⣋⣵⣶⡿⢋⢄⡆⣧⣝⡻⠿⠿⣋⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⣝⠎⣷⢸⣿⣿⣷⠸⣿⡈⢿⣿⣿⣷⣌⢿⣿⣿⣿⡌⢿⣿
# ⣿⣿⡿⣰⣾⣿⣿⡟⣱⢏⣾⣧⢻⣿⠟⣡⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣌⠂⣿⣿⣿⡇⣿⡇⢊⢿⣿⣿⣿⣧⡹⣿⣿⣿⡜⣿
# ⣿⣿⢣⣿⣿⣿⡟⣰⡏⢸⣿⣿⡮⣣⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣟⣻⣭⣭⣭⣭⣽⣛⡻⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣝⢿⣿⣷⢹⡇⡸⡎⢿⣿⣿⣿⣷⡙⣿⣿⣷⣿
# ⣿⡟⣼⣿⣿⣿⢡⣿⠀⣾⣿⡟⣱⣿⣿⣿⣿⣿⣿⡿⢻⣿⣿⣿⣿⣿⣿⣻⣿⣿⣛⣛⠿⢷⣮⣝⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡻⣿⢸⡇⡇⣿⡘⣿⣿⣿⣿⣷⡘⠿⣋⣵
# ⣿⣷⣿⣿⣿⡇⣾⡇⡇⣿⠏⣼⣿⣿⣿⣿⣿⣿⢋⣴⣿⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣮⣝⡻⣮⡻⣿⣿⣿⡙⣿⣿⣿⣿⣿⣿⣷⡙⢸⡇⣧⢻⣧⢹⣿⣿⠿⣋⣵⣾⡿⢏
# ⣿⣿⣿⣿⣿⢸⣿⢱⡇⡟⣼⣿⣿⣿⣿⣿⡿⢡⣿⡟⣩⣾⣿⡛⢿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣝⠊⠻⣿⣿⣌⢿⣿⣿⣿⣿⣿⣿⡌⢳⣿⢸⣿⡈⢟⣵⣾⣿⠟⢫⢰⢣
# ⣿⣿⣿⣿⡇⣿⣿⢸⡇⢱⣿⣿⣿⣿⣿⡿⢱⣿⢋⣾⣿⣿⣿⣿⡆⡙⢷⣙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡘⠻⣿⣆⢻⣿⣿⣿⣿⣿⣿⡄⠟⠼⢋⣴⣿⠟⣫⣵⣿⢸⡖⣡
# ⣿⣿⣿⣿⢰⣿⣿⢸⢇⣿⣿⣿⣿⣿⣿⢡⣿⢣⣾⣿⣿⣿⣿⣿⡇⢹⣤⣙⢷⣝⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣦⡹⣿⣧⢻⣿⣿⣿⣿⣿⣿⡄⢵⣿⠟⣵⣾⣿⣿⢣⡏⢸⣿
# ⣿⣿⣿⡟⣼⣿⣿⠸⣸⣿⣿⣿⣿⣿⡏⣾⢇⣾⣿⣿⣿⣿⣿⣿⡇⣾⣿⣿⣷⣬⣓⢮⣛⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⡜⣿⣆⢿⣿⣿⣿⣿⡟⢿⡜⢣⣾⣿⣿⣿⡏⡎⣼⡇⣿
# ⣿⣿⣿⡇⣿⣿⣿⡆⡟⣿⣿⣿⣿⣿⡇⡟⣼⣿⣿⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣷⣮⣍⣒⠍⢋⡩⠭⢹⣿⣿⣿⣿⣿⡘⣿⡌⣿⣿⣿⣿⣿⡘⣷⢹⣿⣿⣿⡟⡸⣸⣿⣇⣿
# ⣿⣿⣿⢱⣿⣿⣿⢱⡇⣿⣿⣿⣿⣿⡀⢣⣿⣿⣿⣿⣿⣿⢿⣿⢡⣿⣿⣿⣿⣿⣿⣿⣿⣿⢣⣿⡶⢞⣡⣤⡒⠒⠚⣛⣛⣥⢹⣷⠙⣹⣿⣿⣿⣇⣿⡌⣿⣿⣿⢡⢡⣿⣿⣿⣿
# ⣿⣿⣿⢸⣿⣿⡏⢸⡇⣿⣿⣿⣿⣿⡇⣸⣿⣿⣿⣿⣿⡟⢰⠇⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣴⣶⣶⠟⣩⣴⣾⡿⠛⠛⠙⠫⠌⢁⡌⣿⣿⣿⣿⣿⢸⡇⠿⢟⣵⠃⡇⣿⣿⣿⣿
# ⣿⣿⣿⢸⣿⣿⡇⢸⡇⣿⣿⣿⣿⣿⣇⢿⣿⣿⣿⣿⡿⢑⠊⣬⡟⢛⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⢢⡿⠋⠐⠀⢀⠤⠀⠀⠄⢻⡇⣿⣿⣿⣿⡿⢸⣇⣜⠻⢣⣾⡇⣿⣿⣿⣿
# ⣿⣿⣿⢸⣿⣿⢸⣸⡇⣿⣿⣿⣿⣿⣿⠸⣿⣿⣿⡋⠎⠈⠾⡛⠵⠿⢿⣦⣽⣿⣿⣿⣿⣿⣿⣿⣿⣿⠗⢀⣾⡀⠻⢀⣠⠇⢤⢸⢱⣿⣿⣿⣿⡇⠊⡯⠋⣴⣿⣿⣷⣿⣿⣿⣿
# ⣐⠶⣿⣬⣭⣭⣼⡃⣇⢻⣿⣿⣿⣿⣿⣇⢿⣿⡿⠃⣰⢟⣡⣾⣿⣷⣦⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⣼⣿⣿⣯⠍⢁⣰⣿⠘⡜⣿⣿⣿⣿⢱⠀⠃⡇⢹⣿⣿⣿⣿⣿⣿⣿
# ⣜⡳⢄⠲⠎⣭⢟⡃⣿⢸⣿⣿⣿⣿⣿⣿⡘⢟⣥⣾⣧⡾⠛⠉⠉⠉⠉⠻⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⢠⡇⣿⣿⣿⡏⡆⢣⠀⠀⡜⣿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣶⡍⠻⢿⡜⢷⢸⡆⣿⣿⣿⣿⣿⡝⣧⢻⡻⠿⠟⠁⣠⡆⠰⢷⠀⢀⠀⣍⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢃⣿⡇⣿⣿⡟⡼⢰⢸⢀⠆⡇⢿⣿⣿⣿⣿⣿⣿
# ⣿⣿⣿⡇⠞⣶⢉⠲⡌⣿⠸⣿⣿⣿⣿⣷⠹⣄⠻⣿⣶⣦⡙⠿⣶⣆⣘⠛⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⣾⣿⡇⣿⠟⣼⢡⢸⢸⣿⢠⢡⣾⣿⣿⣿⣿⡿⣿
# ⣿⣿⣿⣿⢀⣿⢸⣿⣆⢻⡇⢻⣿⣿⣿⣿⣧⢻⡜⣌⠻⣿⣿⣿⣴⣥⣦⣶⣾⣿⣿⣿⣿⠟⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣿⡇⢏⣾⢣⣾⢨⡇⣿⡆⣼⣿⣼⣿⣿⣿⣇⣿
# ⣿⣿⣿⣿⡘⢸⣼⣿⣿⡌⣷⢀⢿⣿⣿⣿⣿⣧⠹⡌⢳⠝⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡐⠃⣿⣟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣣⡾⢡⣿⡏⣼⠃⣿⡇⣿⣿⣿⣿⣿⣿⢸⣿
# ⣿⣿⣿⣿⡇⡞⣿⣿⣿⣷⡘⡎⡎⢿⣿⣿⣿⣿⡆⡔⠔⢾⣮⡻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⢋⣼⣿⣿⣿⣿⣿⡿⢁⣾⣿⢣⡟⡄⣿⡇⣿⣟⣿⣿⣿⡟⣼⣿
# ⣿⣿⣿⣿⣿⢸⣿⣿⣿⣿⣷⠱⡀⣦⠻⣿⣿⣿⣷⠀⡐⣌⠻⣷⣌⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣛⣯⣵⣾⣿⣿⣿⣿⣿⣿⢏⣴⣿⣿⠃⡚⣰⢇⣿⢱⢻⣿⣿⣿⣿⢇⣿⣿
# ⣿⣿⣿⣿⣿⡌⣿⣿⣿⣿⣿⡇⡡⠡⢡⡌⢿⣇⢻⣤⢳⠙⣰⣈⣻⣿⣮⣛⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⣡⣿⣿⠟⢁⢀⣴⡿⢸⡿⡘⣼⣿⣿⣿⣿⢸⣿⣿
# ⣿⣿⣿⣿⣿⣇⢻⣿⣿⣿⣿⡇⡇⠀⠙⠡⣰⣝⠎⡿⡘⡆⣿⣿⣿⣿⣿⣿⣷⣶⣭⣭⣟⣛⣛⡿⠿⠿⠿⣿⣿⣿⡿⢟⣡⣾⡿⠟⠁⠀⡁⢿⣿⣧⣿⡇⢣⣿⣿⣿⣿⣧⣿⢇⣿
# ⣿⣿⣿⣿⣿⣿⡸⣿⣿⣿⣿⡇⡇⣀⢔⣴⣿⣿⣷⢠⣷⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣄⡀⠀⡀⠀⣐⣚⣛⣭⠱⢀⡀⢀⣌⢿⣮⠻⣿⣿⠰⣼⣿⣿⣿⣿⣿⡟⣼⣿
# ⣿⣿⣿⣿⣿⣿⡇⢿⣿⣿⣿⡇⢷⣶⣿⣿⣿⣿⣿⣸⣿⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⡆⣲⡆⣶⡆⣿⣿⡿⠌⢻⣦⡻⣷⡝⠏⢄⣿⣿⣿⣿⣿⣿⢡⣿⣿
# ⣿⣿⣿⣿⣿⣿⣧⠸⣿⣿⣿⡇⢸⣿⣿⣿⣿⣿⣿⣿⣿⢸⣿⣌⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⢸⡇⣿⠇⣱⣶⣬⣝⡣⠹⣷⡜⢿⡆⣸⣿⣿⣿⣿⣿⡟⣼⣿⣿
# ⣿⣿⣿⣿⣿⣿⣿⢀⢻⣿⣿⣿⢸⣿⣿⣿⣿⣿⣿⣿⣿⣸⣿⣿⣷⡙⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⢼⡇⢋⡄⣿⠿⠟⠛⠉⠁⠘⢿⣮⢃⣿⣿⣿⣿⣿⣿⢇⣿⣿⣿
# ⣿⣿⢹⣿⣿⣿⣿⡇⡜⣿⣿⣿⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣮⡻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠘⣠⢸⡇⠠⡀⢀⣀⣀⣀⣤⠈⠻⢸⣿⣿⣿⣿⣿⣿⢸⣿⢋⣿
# ⣿⣿⡎⣿⣿⣿⣿⣷⢱⢹⣿⣿⢈⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢸⣿⢸⡇⢸⣿⣿⠿⢟⣛⣩⣤⣥⢸⣿⡟⣿⣿⣿⡟⣼⡏⣼⣿